<!DOCTYPE html>
<html>
  <head>
    <link rel="stylesheet" href="../css/reviews.css">
    <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
    <script src="https://www.gstatic.com/firebasejs/6.0.2/firebase.js"></script>
    <script>
      // Your web app's Firebase configuration
      var firebaseConfig = {
        apiKey: "AIzaSyCYfjxsTKKJXBflLGY25wU-9oB-srQTmAI",
        authDomain: "designshine-surfapp.firebaseapp.com",
        databaseURL: "https://designshine-surfapp.firebaseio.com",
        projectId: "designshine-surfapp",
        storageBucket: "designshine-surfapp.appspot.com",
        messagingSenderId: "257277932654",
        appId: "1:257277932654:web:365249aeda12648e"
      };
      // Initialize Firebase
      firebase.initializeApp(firebaseConfig);
    </script>

    <script src="../jquery-3.3.1.min.js"></script>

    <script type="text/javascript">
      $(document).ready(() => {
        var html = '';
        const database = firebase.database();
        database.ref('reviews/').once('value', (snapshot) => {
          const data = snapshot.val();
          console.log('You received some data!', Object.keys(data));
          //$('#reviews').html(<p> data[Object.keys(data)]</p>);
          (Object.keys(data)).forEach(function(id) {
            html += '<p>';
            html += data[id];
            html += '</p>';
            html += '<br><hr width="75%"/>';
          });
          $('#reviews').html(html);
        });

      });
    </script>

  </head>

  <div>
    <h2>Reviews</h2>
    <div id="reviews">
    </div>

    <h2>More reviews from Google users</h2>
    <div>
      <strong>Overall Google rating:</strong>
      <span id="rating"></span>
    </div>
    <div id="googleReviews">

    </div>

    <div class="reviews"><ul class="review-list"></ul></div>
    <div id="map"></div>

    <script>
      //get google reviews
      var map, service;

      function initMap() {
        var oceansideHarbor = new google.maps.LatLng(33.2078, -117.3950);

        map = new google.maps.Map(document.getElementById("map"), {
          center: oceansideHarbor,
          zoom: 15
        });

        var request = {
          location: oceansideHarbor,
          radius: "500",
          types: ['park']
        };

        service = new google.maps.places.PlacesService(map);
        service.nearbySearch(request, searchResult);
      }

      function searchResult(results, status) {
        if (status == google.maps.places.PlacesServiceStatus.OK) {
          // show first result on map and request for details
          var place = results[0];
          var marker = new google.maps.Marker({
            position: place.geometry.location,
            map: map,
            title: place.name
          });
          var infowindow = new google.maps.InfoWindow({
            content: place.name
          });
          infowindow.open(map, marker);

          service.getDetails({placeId: place.place_id}, function(place, status) {
            if (status == google.maps.places.PlacesServiceStatus.OK) {
              let rating = document.querySelector('#rating');
              let reviewEl = document.querySelector('.review-list');

              rating.innerHTML = place.rating;

              for (let review of place.reviews){
                let rev = document.createElement('div');
                rev.innerHTML = `<div>Author: ${review.author_name}</div>
                                <p>${review.text}</p>
                                <div>Rating: ${review.rating} star(s)</div>
                                <br><hr width="75%"/><br>`;
                reviewEl.appendChild(rev);
              }
            }
          });
        }
      }
    </script>

    <!-- google reviews api -->
    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDSgPgFsM2dB9058bOAmGw_tZmheEM0qjc&callback=initMap&libraries=places"
    async defer></script>
  </div>

  <footer id="footer">
    <div id="menu">
      <a href="home.html"> <img src="../images/home.png"> </a>
      <a href="profile.html"> <img src="../images/profile.png"> </a>
    </div>
  </footer>
</html>
